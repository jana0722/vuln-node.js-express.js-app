rules:
  - id: ssrf.user-input-to-http-client
    languages: [javascript, typescript]
    message: "Possible SSRF: user-controlled data used as a URL in an HTTP request."
    severity: WARNING
    mode: taint

    pattern-sources:
      - pattern-either:
          - pattern: req.query.$X
          - pattern: req.params.$X
          - pattern: req.body.$X
          - pattern: req.headers[$X]
          - pattern: req.headers.get($X)
          - pattern: context.request.query.$X
          - pattern: context.request.body.$X

    pattern-sinks:
      - pattern-either:
          # fetch / node-fetch / undici-style
          - pattern: fetch($URL, ...)
          - pattern: fetch(new URL($URL), ...)
          - pattern: $FETCH.fetch($URL, ...)
          # axios
          - pattern: axios($URL, ...)
          - pattern: axios.get($URL, ...)
          - pattern: axios.post($URL, ...)

          
          # got
          - pattern: got($URL, ...)
          - pattern: got.get($URL, ...)
          - pattern: got.post($URL, ...)
          # request / request-promise (legacy)
          - pattern: request($URL, ...)
          - pattern: request.get($URL, ...)
          - pattern: request.post($URL, ...)

          # http/https core modules
          - pattern: require("http").request($URL, ...)
          - pattern: require("https").request($URL, ...)
          - pattern: $HTTP.request($URL, ...)
          - pattern: $HTTPS.request($URL, ...)

    pattern-sanitizers:
      - pattern-either:
          # allow-list checks (you can expand this to match your codebase)
          - pattern: allowlistHost($URL)
          - pattern: isAllowedUrl($URL)
          - pattern: validateUrl($URL)
          - pattern: assertAllowedUrl($URL)
